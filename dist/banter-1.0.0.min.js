/*! BanterJS by Adam Timberlake created on 2013-08-21 */
!function(a,b){a.banterApp=angular.module("banterApp",[]),banterApp.factory("$logger",["$rootScope",function(){var a={};return a.log=function(a){console.log("Banter.js @ "+moment().format("HH:mm:ss")+" - "+a)},a.error=function(a){console.error("Banter.js @ "+moment().format("HH:mm:ss")+" - "+a)},a}]),banterApp.factory("$webSocket",["$rootScope","$logger",function(a,c){var d={};return a.webSocket={},d.connect=function(d){var e;a.webSocket=e=new WebSocket(d),a.webSocket.onclose=function(){a.$broadcast("disconnected")},e.onopen=function(){c.log("Banter.js Connected, Sugar!"),a.$broadcast("connected")},e.onerror=function(){a.$broadcast("error"),c.error("Client Threw an Error, Petal!")},e.onmessage=function(d){if("undefined"==typeof b)return console.error("Please install jQuery to continue using Banter.js."),!1;var e=b.parseJSON(d.data);return e.command?(c.log("Command Received ("+d.data.length+" Characters), Honey..."),a.$broadcast("receivedCommand",e),void 0):(console.log(d.data),c.log("Message Received ("+d.data.length+" Characters), Sweetie..."),e.date=moment().format("MMMM Do YYYY, HH:mm:ss"),a.$broadcast("receivedMessage",e),void 0)}},a.$on("sendMessage",function(b,d){var e=JSON.stringify(d);c.log("Message Sent ("+e.length+" Characters), Cherry..."),a.webSocket.send(e)}),a.$on("setUsername",function(b,c){var d=JSON.stringify({command:!0,username:c});a.webSocket.send(d)}),d}]),banterApp.controller("RegisterController",["$scope",function(a){a.username=sessionStorage.getItem("username")||"",a.registerUsername=function(){sessionStorage.setItem("username",a.username),a.$parent.username="Banter-"+a.username,a.$parent.connect()}}]),banterApp.controller("ApplicationController",["$scope","$webSocket","$logger",function(a,b,c){a.connected=!1,a.status="Connecting...",a.error=!1,a.messages=[],a.message="",a.gravatar="",a.url="",a.username="",a.$on("bootstrap",function(b,d){c.log("Client Connecting: "+d),a.url=d}),a.connect=function(){a.status="Connecting...",a.error=!1,b.connect(a.url)},a.$on("connected",function(){a.$emit("setUsername",a.username)}),a.$on("disconnected",function(){a.status="Disconnected",a.error=!0,a.connected=!1,a.$apply()}),a.$on("error",function(){a.status="Failed",a.error=!0,a.$apply()}),a.$on("receivedMessage",function(b,c){return a.messages.unshift(c),a.$apply(),!0}),a.$on("receivedCommand",function(b,c){c.connected&&(a.gravatar=c.gravatar,a.connected=!0,a.$apply())}),a.disconnect=function(){var b={command:!0,disconnect:!0};a.connected=!1,a.status="Disconnected",a.$emit("sendMessage",b)},a.sendMessage=function(b){var c={name:a.username,message:b,date:moment().format("MMMM Do YYYY, HH:mm:ss"),gravatar:a.gravatar};a.messages.unshift(c),a.message="",a.$emit("sendMessage",c)}}]),banterApp.directive("banter",["$rootScope",function(a){return{restrict:"C",link:function(b){var c="undefined"!=typeof b.websocketServer?b.websocketServer:"ws://localhost:8080";a.$broadcast("bootstrap",c)}}}])}(window,jQuery);